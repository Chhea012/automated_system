{% extends "base.html" %}
{% block title %}View Contract - {{ contract.contract_number }}{% endblock %}
{% block content %}
<!-- Navigation Buttons -->
<div class="d-flex justify-content-center mt-3 mb-2 gap-2">
    <a href="{{ url_for('contracts.index') }}" class="btn btn-secondary mr-2">Back to List</a>
    <a href="{{ url_for('contracts.export_docx', contract_id=contract.id) }}" class="btn btn-primary">Export to DOCX</a>
</div>

<div class="container d-flex justify-content-center mt-3">
    <div class="container-card shadow-sm p-5 mb-3" style="font-family: Calibri, sans-serif; ">
        <!-- Header -->
        <h1 class="text-center mt-5" style="font-size: 24px; font-weight: bold;">The Service Agreement</h1>
        <p class="text-center" style="font-weight: bold;">ON</p>
        <h2 class="text-center" style="font-size: 18px;">{{ contract.project_title or 'N/A' }}</h2>
        <p class="text-center" style="font-weight: bold;">No.: {{ contract.contract_number or 'N/A' }}</p>
        <p class="text-center">BETWEEN</p>

        <!-- Party A -->
        <p class="text-center">
            <strong>The NGO Forum on Cambodia</strong>, represented by <strong>Mr. Soeung Saroeun</strong>, Executive Director.<br>
            Address: #9-11, Street 476, Sangkat Tuol Tumpoung I, Phnom Penh, Cambodia.<br>
            hereinafter called the “<strong>Party A</strong>”
        </p>

        <p class="text-center">AND</p>

        <!-- Party B -->
        <p class="text-center ">
            <strong>{{ contract.party_b_position or 'N/A' }} {{ contract.party_b_signature_name or 'N/A' }}</strong>,<br>
            Address: {{ contract.party_b_address or 'N/A' }}<br>
            H/P: {{ contract.party_b_phone or 'N/A' }}, E-mail: <span style="color: blue; text-decoration: underline;">{{ contract.party_b_email or 'N/A' }}</span><br>
            hereinafter called the “<strong>Party B</strong>”
        </p>

        <!-- Whereas Clauses -->
        <p class="">
            Whereas NGOF is a legal entity registered with the Ministry of Interior (MOI) {{ contract.registration_number or '#304 សជណ' }} dated {{ contract.registration_date or '07 March 2012' }}.
        </p>
        <p class="">
            Whereas NGOF will engage the services of “<strong>Party B</strong>” which accepts the engagement under the following terms and conditions.
        </p>
        <p class="text-center" style="font-weight: bold;">Both Parties Agreed as follows:</p>

        <!-- Articles -->
        {% for article in standard_articles %}
        <h6 class="mb-1" style="font-weight: bold;">
            <span style="text-decoration: underline;">ARTICLE {{ article.number }}:</span> {{ article.title }}
        </h6>

        <p {% if article.number == 14 %}style="white-space: pre-line;"{% endif %}>
            {% if article.number == 6 %}
                {% set parts = article.content.split(' Email: ') %}
                {% set focal_email = contract.focal_person_a_email or 'N/A' %}
                {% set party_b_email = contract.party_b_email or 'N/A' %}
                {{ parts[0] | replace('Party A', '<strong>Party A</strong>') | replace('Party B', '<strong>Party B</strong>') | safe }}
                Email: <span style="color: blue; text-decoration: underline;">{{ focal_email }}</span>
                {{ parts[1].split(' E-mail: ')[0] | safe }}
                E-mail: <span style="color: blue; text-decoration: underline;">{{ party_b_email }}</span>
                {{ parts[1].split(' E-mail: ')[1] | replace('Party A', '<strong>Party A</strong>') | replace('Party B', '<strong>Party B</strong>') | safe }}
            {% else %}
                {{ article.content | replace('Party A', '<strong>Party A</strong>') | replace('Party B', '<strong>Party B</strong>') | safe }}
            {% endif %}
        </p>

        {% if article.table %}
        <table class="table table-bordered">
            <thead>
                <tr>
                    {% for key in article.table[0].keys() %}
                    <th class="text-center">{{ key }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in article.table[1:] %}
                <tr>
                    {% for key in row.keys() %}
                    <td style="white-space: pre-line;">{{ row[key] }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% for custom in articles %}
        {% if custom.article_number | string == article.number | string %}
        <p>{{ custom.custom_sentence }}</p>
        {% endif %}
        {% endfor %}
        {% endfor %}

        <!-- Signatures -->
        <p class="text-center mt-3 mb-2" style="font-weight: bold;">
            Date: {{ format_date(contract.agreement_start_date) }}
        </p>
        <table class="table table-borderless">
            <tr>
                <td class="text-center" style="width: 50%;">
                    <strong>For “Party A”</strong><br>
                    _________________<br>
                    <strong>Mr. SOEUNG Saroeun</strong><br>
                    <strong>Executive Director</strong>
                </td>
                <td class="text-center" style="width: 50%;">
                    <strong>For “Party B”</strong><br>
                    _________________<br>
                    <strong>{{ contract.party_b_signature_name or 'N/A' }}</strong><br>
                    <strong>{{ contract.party_b_position or 'N/A' }}</strong>
                </td>
            </tr>
        </table>
    </div>
</div>
{% endblock %}
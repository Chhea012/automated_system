{% extends "base.html" %}
{% block title %}View Contract - {{ contract.contract_number }}{% endblock %}
{% block content %}
<!-- Navigation Buttons -->
<div class="d-flex justify-content-center mt-3 mb-2 gap-2">
    <a href="{{ url_for('contracts.index') }}" class="btn btn-secondary">Back to List</a>
    <a href="{{ url_for('contracts.export_docx', contract_id=contract.id) }}" class="btn btn-primary">Export to DOCX</a>
</div>

<div class="container d-flex justify-content-center mt-3">
    <div class="container-card shadow-sm p-5 mb-3" style="font-family: Calibri, sans-serif; max-width: 800px;">
        <!-- Header -->
        <h1 class="text-center mt-5" style="font-size: 18px; font-weight: bold;">The Service Agreement</h1>
        <p class="text-center" style="font-weight: bold; font-size: 14px;">ON</p>
        <h2 class="text-center" style="font-size: 18px;"><strong>{{ contract.project_title or 'N/A' }}</strong></h2>
        <p class="text-center" style="font-weight: bold; font-size: 18px;">No.: {{ contract.contract_number or 'N/A' }}</p>
        <p class="text-center" style="font-size: 16px;">BETWEEN</p>

        <!-- Party A -->
        <p class="text-center" style="font-size: 16px;">
            <strong>The NGO Forum on Cambodia</strong>, represented by 
            {% for person in contract.party_a_info %}
                <strong>{{ person.name or 'Mr. Soeung Saroeun' }}</strong>, {{ person.position or 'Executive Director' }}
                {% if not loop.last %}; {% endif %}
            {% endfor %}.<br>
            Address: {{ contract.party_a_info[0].address or '#9-11, Street 476, Sangkat Tuol Tumpoung I, Phnom Penh, Cambodia' }}.<br>
            hereinafter called the “<strong>Party A</strong>”
        </p>

        <p class="text-center" style="font-size: 16px;">AND</p>

        <!-- Party B -->
        <p class="text-center" style="font-size: 16px;">
            {% if contract.party_b_info %}
                {% for person in contract.party_b_info %}
                    <strong>{{ person.position or 'Freelance Consultant' }} {{ person.name or 'N/A' }}</strong>
                    {% if not loop.last %}; {% endif %}
                {% endfor %},<br>
                Address: {{ contract.party_b_info[0].address or 'N/A' }}<br>
                H/P: {{ contract.party_b_info[0].phone or 'N/A' }}, E-mail: <span style="color: blue; text-decoration: underline;">{{ contract.party_b_info[0].email or 'N/A' }}</span><br>
            {% else %}
                <strong>{{ contract.party_b_position or 'Freelance Consultant' }} {{ contract.party_b_signature_name or 'N/A' }}</strong>,<br>
                Address: {{ contract.party_b_address or 'N/A' }}<br>
                H/P: {{ contract.party_b_phone or 'N/A' }}, E-mail: <span style="color: blue; text-decoration: underline;">{{ contract.party_b_email or 'N/A' }}</span><br>
            {% endif %}
            hereinafter called the “<strong>Party B</strong>”
        </p>

        <!-- Whereas Clauses -->
        <p style="font-size: 14px;">
            Whereas NGOF is a legal entity registered with the Ministry of Interior (MOI) {{ contract.registration_number or '#304 សជណ' }} dated {{ contract.registration_date or '07 March 2012' }}.
        </p>
        <p style="font-size: 14px;">
            Whereas NGOF will engage the services of “<strong>Party B</strong>” which accepts the engagement under the following terms and conditions.
        </p>
        <p class="text-center" style="font-weight: bold; font-size: 14px;">Both Parties Agreed as follows:</p>

        <!-- Articles -->
        {% for article in standard_articles %}
        <h6 class="mb-1" style="font-weight: bold;">
            <span style="text-decoration: underline;">ARTICLE {{ article.number }}:</span> {{ article.title }}
        </h6>
        <p style="white-space: pre-line; font-size: 14px;">
            {{ article.content | replace('Party A', '<strong>Party A</strong>') | replace('Party B', '<strong>Party B</strong>') | safe }}
        </p>
        {% if article.table %}
        <table class="table table-bordered" style="border: 1px solid black;">
            <thead>
                <tr>
                    {% for key in article.table[0].keys() %}
                    <th class="text-center text-black" style="border: 1px solid black;">{{ key }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in article.table[1:] %}
                <tr>
                    {% for key in row.keys() %}
                        <td style="white-space: pre-line; border: 1px solid black; {% if key == 'Total Amount (USD)' %}font-weight: bold;{% endif %}">
                            {{ row[key] }}
                        </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
        {% for custom in articles %}
        {% if custom.article_number | string == article.number | string %}
        <p style="white-space: pre-line; font-size: 14px;">{{ custom.custom_sentence }}</p>
        {% endif %}
        {% endfor %}
        {% endfor %}

        <!-- Signatures -->
        <p class="text-center mt-3 mb-2" style="font-weight: bold; font-size: 15px;">
            Date: {{ contract.agreement_start_date_display or 'N/A' }}
        </p>
        <table class="table table-borderless" style="margin-left: 17%; font-size: 15px;">
            <tr>
                <td class="text-start" style="width: 40%;">
                    <div style="margin-bottom: 50px;">
                        <strong>For “Party A”</strong>
                    </div>
                    _________________<br>
                    {% for person in contract.party_a_info %}
                        {% if person.name == contract.party_a_signature_name %}
                            <strong>{{ person.name or 'Mr. SOEUNG Saroeun' }}</strong><br>
                            <strong>{{ person.position or 'Executive Director' }}</strong>
                        {% endif %}
                    {% endfor %}
                </td>
                <td class="text-start" style="width: 50%;">
                    <div style="margin-bottom: 40px;">
                        <strong>For “Party B”</strong>
                    </div>
                    _________________<br>
                    {% if contract.party_b_info %}
                        {% for person in contract.party_b_info %}
                            {% if person.name == contract.party_b_signature_name %}
                                <strong>{{ person.name or 'N/A' }}</strong><br>
                                <strong>{{ person.position or 'N/A' }}</strong>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <strong>{{ contract.party_b_signature_name or 'N/A' }}</strong><br>
                        <strong>{{ contract.party_b_position or 'N/A' }}</strong>
                    {% endif %}
                </td>
            </tr>
        </table>        
    </div>
</div>
{% endblock %}